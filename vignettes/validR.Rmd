---
title: "validR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{validR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The validR is a set of functions to be used for testing and validating data. 
The main functions are:

- **test_range**: tests if column values are within a certain range
- **test_values**: tests if column values are certain categories
- **test_unique**: tests column values are unique
- **test_na**: tests column values don't contain NAs
- **test_test_orphan_rec**: tests if merge between primary and related table doesn't result in any orphaned keys

To use the testing functions first create the test setup. How each test class should be setup can be found by ?setup_test_range in the details section.

- setup_test_range
- setup_test_values
- setup_test_unique
- setup_test_na
- setup_test_orphan_rec

## Column Tests

```{r, eval = FALSE, echo = TRUE}

library(validR)

df <- data.frame(x = 1:10, y = c(rep("X", 4), rep("Y", 4), rep("Z", 2)))


setup1 <- setup_test_range(df_name = "df", col_name = "x", int = TRUE, lower_inclu = TRUE,
                           upper_inclu = TRUE, lower = 1, upper = 10, na = FALSE)

setup2 <- setup_test_values(df_name = "df", col_name = "y", values = c("X", "Y"), na = FALSE)

setup3 <- setup_test_unique(df_name = "df", col_name = "x", na = FALSE)

setup4 <- setup_test_na(df_name = "df", col_name = "y")

test1 <- test(setup1, df)
test2 <- test(setup2, df)
test3 <- test(setup3, df)
test4 <- test(setup4, df)




tests <- rbind(test1, test2, test3, test4)

```

## Merge Tests

```{r}

library(validR)

primary_df <- data.frame(id1 = c(1,2,2,3), id2 = c(1,1,2,1), y = c(1,1,2,5))
related_df <- data.frame(id1 = c(1,2,3), id2 = c(1,1,1), x = c(1,2,3))

setup <- setup_test_orphan_rec(primary_df = "df1", related_df = "df2", 
                               primary_key = c("id1", "id2"), foreign_key = c("id1", "id2"))

test1 <- test(setup, primary_df, related_df)

primary_df <- data.frame(id = c(1,2,2), id2 = c(1,1,2), y = c(1,1,2))
related_df <- data.frame(id1 = c(1,2,15), id2 = c(1,1,1), x = c(1,2,3))

setup <- setup_test_orphan_rec(primary_df = "df1", related_df = "df2", 
                               primary_key = c("id", "id2"), foreign_key = c("id1", "id2"))

test2 <- test(setup, primary_df, related_df)

```